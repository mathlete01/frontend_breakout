const BASE_URL="https://evening-hollows-06706.herokuapp.com",PLAYERS_URL=`${BASE_URL}/players`,GAMES_URL=`${BASE_URL}/games`,leaderboard=document.getElementById("leaderboard"),browser=navigator.appName,platform=navigator.platform,w=window.innerWidth,h=window.innerHeight,colorLight="#dfdfdf",colorKeyUpStroke=colorLight,colorKeyUpFill="#ffffff",colorKeyFontUp=colorLight,colorKeyDownStroke="#000000",colorKeyDownFill="#000000",colorKeyFontDown="#ffffff",colorKeyGrayFill="#808080",colorBallFill="#000000",colorBallStroke="#000000",strokeThickness=1,typeFont=window.innerWidth/100+"px Courier New";let speed=.3,lives=3;const livesText=document.getElementById("livesText"),scoreText=document.getElementById("scoreText");let scoreNote1=493.883,scoreNote2=659.255;const scoreIncrement=1e3,canvas=document.getElementById("myCanvas"),keySegments=15,factor=5/keySegments;canvas.width=w,canvas.height=factor*w;const ctx=canvas.getContext("2d"),ballRadius=10,x=canvas.width/2,y=canvas.height/2;let dx=speed,dy=-1*dx,rightPressed=!1,leftPressed=!1;const keyRowCount=5,keyColumnCount=15,keyPadding=10,keyOffsetTop=30,keyOffsetLeft=30,keyWidth=w/keySegments,keyHeight=keyWidth,topRow=100;let interval="",score=0,directionV="north",directionH="east";const AudioContext=window.AudioContext||window.webkitAudioContext,context=new AudioContext;let gameOn=!1;const vol=.05,row0=[{name:"`",code:"Backquote",row:0,segments:1,status:0,position:0},{name:"1",code:"Digit1",row:0,segments:1,status:0,position:1},{name:"2",code:"Digit2",row:0,segments:1,status:0,position:2},{name:"3",code:"Digit3",row:0,segments:1,status:0,position:3},{name:"4",code:"Digit4",row:0,segments:1,status:0,position:4},{name:"5",code:"Digit5",row:0,segments:1,status:0,position:5},{name:"6",code:"Digit6",row:0,segments:1,status:0,position:6},{name:"7",code:"Digit7",row:0,segments:1,status:0,position:7},{name:"8",code:"Digit8",row:0,segments:1,status:0,position:8},{name:"9",code:"Digit9",row:0,segments:1,status:0,position:9},{name:"0",code:"Digit0",row:0,segments:1,status:0,position:10},{name:"-",code:"Minus",row:0,segments:1,status:0,position:11},{name:"=",code:"Equal",row:0,segments:1,status:0,position:12},{name:"Backspace",code:"Backspace",row:0,segments:2,status:0,position:13}],row1=[{name:"Tab",code:"Tab",row:1,segments:2,status:0,position:0},{name:"q",code:"KeyQ",row:1,segments:1,status:0,position:2},{name:"w",code:"KeyW",row:1,segments:1,status:0,position:3},{name:"e",code:"KeyE",row:1,segments:1,status:0,position:4},{name:"r",code:"KeyR",row:1,segments:1,status:0,position:5},{name:"t",code:"KeyT",row:1,segments:1,status:0,position:6},{name:"y",code:"KeyY",row:1,segments:1,status:0,position:7},{name:"u",code:"KeyU",row:1,segments:1,status:0,position:8},{name:"i",code:"KeyI",row:1,segments:1,status:0,position:9},{name:"o",code:"KeyO",row:1,segments:1,status:0,position:10},{name:"p",code:"KeyP",row:1,segments:1,status:0,position:11},{name:"[",code:"BracketLeft",row:1,segments:1,status:0,position:12},{name:"]",code:"BracketRight",row:1,segments:1,status:0,position:13},{name:"\\",code:"Backslash",row:1,segments:1,status:0,position:14}],row2=[{name:"CapsLock",code:"CapsLock",row:2,segments:2,status:0,position:0},{name:"a",code:"KeyA",row:2,segments:1,status:0,position:2},{name:"s",code:"KeyS",row:2,segments:1,status:0,position:3},{name:"d",code:"KeyD",row:2,segments:1,status:0,position:4},{name:"f",code:"KeyF",row:2,segments:1,status:0,position:5},{name:"g",code:"KeyG",row:2,segments:1,status:0,position:6},{name:"h",code:"KeyH",row:2,segments:1,status:0,position:7},{name:"j",code:"KeyJ",row:2,segments:1,status:0,position:8},{name:"k",code:"KeyK",row:2,segments:1,status:0,position:9},{name:"l",code:"KeyL",row:2,segments:1,status:0,position:10},{name:":",code:"Semicolon",row:2,segments:1,status:0,position:11},{name:"'",code:"Quote",row:2,segments:1,status:0,position:12},{name:"Enter",code:"Enter",row:2,segments:2,status:0,position:13}],row3=[{name:"Shift",code:"ShiftLeft",row:3,segments:2.5,status:0,position:0},{name:"z",code:"KeyZ",row:3,segments:1,status:0,position:2.5},{name:"x",code:"KeyX",row:3,segments:1,status:0,position:3.5},{name:"c",code:"KeyC",row:3,segments:1,status:0,position:4.5},{name:"v",code:"KeyV",row:3,segments:1,status:0,position:5.5},{name:"b",code:"KeyB",row:3,segments:1,status:0,position:6.5},{name:"n",code:"KeyN",row:3,segments:1,status:0,position:7.5},{name:"m",code:"KeyM",row:3,segments:1,status:0,position:8.5},{name:",",code:"Comma",row:3,segments:1,status:0,position:9.5},{name:".",code:"Period",row:3,segments:1,status:0,position:10.5},{name:"/",code:"Slash",row:3,segments:1,status:0,position:11.5},{name:"Shift",code:"ShiftRight",row:3,segments:2.5,status:0,position:12.5}],row4=[{name:"Function",code:"",row:4,segments:1,status:0,position:0},{name:"Control",code:"ControlLeft",row:4,segments:1,status:0,position:1},{name:"Alt",code:"AltLeft",row:4,segments:1,status:0,position:2},{name:"⌘",code:"MetaLeft",row:4,segments:1.5,status:0,position:3},{name:"Space",code:"Space",row:4,segments:5,status:0,position:4.5},{name:"⌘",code:"MetaRight",row:4,segments:1.5,status:0,position:9.5},{name:"Alt",code:"AltRight",row:4,segments:1,status:0,position:11},{name:"←",code:"ArrowLeft",row:4,segments:1,status:0,position:12},{name:"↑",code:"ArrowUp",row:4,segments:1,status:0,position:13},{name:"↓",code:"ArrowDown",row:4,segments:1,status:0,position:13},{name:"→",code:"ArrowRight",row:4,segments:1,status:0,position:14}],preventDefaultKeys={Tab:!0,Enter:!0};document.addEventListener("DOMContentLoaded",t=>{let e=document.getElementById("nameField");e.placeholder="Enter your name";const o=document.getElementById("skipButton");o.addEventListener("click",()=>{document.location.reload()});const n=document.getElementById("saveButton");n.addEventListener("click",()=>function(t){var e={id:CURRENT_PLAYER,name:t},e={method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)};fetch(PLAYERS_URL,e).then(t=>t.json()).then(function(t){t={id:CURRENT_GAME,name:t},t={method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)};fetch(GAMES_URL,t).then(t=>t.json()).then(t=>function(){r.toggle(),document.location.reload()}(t.player_id)).catch(t=>console.log(`updateGame: ${t}`))}(t)).catch(t=>console.log(`savePlayer: ${t}`))}(e.value.toUpperCase()));const c=document.getElementById("aboutNav");c.addEventListener("click",()=>l.toggle());const s=document.getElementById("hireMeNav");s.addEventListener("click",()=>d.toggle());const i=document.getElementById("closeAboutButton");i.addEventListener("click",()=>l.toggle());const a=document.getElementById("closeHireMeButton");a.addEventListener("click",()=>d.toggle());const r=new bootstrap.Modal(document.getElementById("saveModal"),{keyboard:!1}),l=new bootstrap.Modal(document.getElementById("aboutModal"),{keyboard:!1}),d=new bootstrap.Modal(document.getElementById("hireMeModal"),{keyboard:!1});function m(t,e,o,n){const c=context.createOscillator(),s=context.createOscillator(),i=context.createGain();c.type=n,s.type=n,i.gain.value=vol,c.connect(i),s.connect(i),i.connect(context.destination),c.frequency.value=t+1,s.frequency.value=t-2,i.gain.setValueAtTime(vol,e+o-.05),i.gain.linearRampToValueAtTime(0,e+o),c.start(e),s.start(e),c.stop(e+o),s.stop(e+o)}function p(){switch(directionV){case"north":directionV="south";break;case"south":directionV="north";break;default:return}}function u(){!0===gameOn?(colorKeyUpStroke="#000000",colorKeyUpFill="#ffffff",colorKeyFontUp="#000000"):!1===gameOn&&(colorKeyUpStroke=colorLight,colorKeyUpFill="#ffffff",colorKeyFontUp=colorLight)}function g(){switch(directionH){case"east":directionH="west";break;case"west":directionH="east";break;default:return}}function h(t){CURRENT_PLAYER=t.id,function(t){leaderboard.innerHTML="";t={player_id:t},t={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)};fetch(GAMES_URL,t).then(t=>t.json()).then(t=>function(t){CURRENT_GAME=t.id,gameOn=!0,u(),m(391.995,context.currentTime,.116,"square"),m(391.995,context.currentTime+.116,.116,"square"),m(523.251,context.currentTime+.232,.232,"square"),document.body.addEventListener("keydown",t=>function(t){let e=t.code;preventDefaultKeys[e]&&t.preventDefault();let o=KEY_ARRAY.find(({code:t})=>t===e);return o.s=1,!1}(t)),document.body.addEventListener("keyup",t=>function(t){let e=t.code,o=KEY_ARRAY.find(({code:t})=>t===e);return o.s=0,!1}(t)),v(row0),v(row1),v(row2),v(row3),v(row4),interval=setInterval(T,10)}(t)).catch(t=>console.log(`createGame Failed: ${t}`))}(CURRENT_PLAYER)}function w(){gameOn=!1,u(),m(207.652,context.currentTime,.116,"square"),m(174.614,context.currentTime+.116,.116,"square"),m(146.832,context.currentTime+.232,.232,"square"),clearInterval(interval),interval="";var t={id:CURRENT_GAME,score:score},t={method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)};fetch(GAMES_URL,t).then(t=>t.json()).then(void(0<score?r.toggle():document.location.reload())).catch(t=>console.log(`endGame: ${t}`))}function f(e){for(let t=0;t<e.length;t++){var o=e[t],n=Math.round(o.x),c=Math.round(o.x+o.w),s=Math.round(o.y),i=Math.round(o.y+o.h),a=ballRadius;1==o.s&&(y>s+a&&y<i-a&&x>n+a&&x<c-a&&(o.s,function(t,e,o,n,c,s){ctx.beginPath(),ctx.rect(o,n,c,s),ctx.strokeStyle=colorKeyDownStroke,ctx.lineWidth=strokeThickness,ctx.stroke(),ctx.closePath(),ctx.fillStyle=colorKeyGrayFill,ctx.fill(),ctx.closePath(),ctx.id=e,ctx.font=typeFont,ctx.fillStyle=colorKeyFontDown;t=t.toUpperCase();ctx.textAlign="center",ctx.fillText(t,o+c/2,n+s/2+4)}(o.name,o.code,o.x,o.y,o.w,o.h)),y>s-a&&y<i+a&&(x>n-a&&x<n+a&&"east"===directionH&&(dx=-dx,g(),k()),x>c-a&&x<c+a&&"west"===directionH&&(dx=-dx,g(),k())),x>n-a&&x<c+a&&(y>s-a&&y<s+a&&"south"===directionV&&(dy=-dy,p(),k()),y>i-a&&y<i+a&&"north"===directionV&&(dy=-dy,p(),k())))}}function k(){R(KEY_ARRAY),m(scoreNote1,context.currentTime,.116,"square"),m(scoreNote2,context.currentTime+.116,.232,"square"),score+=scoreIncrement,scoreNote1+=10,scoreNote2+=10,dx*=1.3}function v(e){for(let t=0;t<e.length;t++){var o=e[t].name,n=e[t].code,c=Math.round(e[t].segments*keyWidth),s=keyHeight,i=e[t].position*keyWidth,a=e[t].row*keyHeight,r=e[t].status;KEY_ARRAY.push({name:o,code:n,x:i,y:a,w:c,h:s,s:r})}}function A(e){for(let t=0;t<e.length;t++){var o=e[t];1==o.s&&function(t,e,o,n,c,s){ctx.beginPath(),ctx.rect(o,n,c,s),ctx.strokeStyle=colorKeyDownStroke,ctx.lineWidth=strokeThickness,ctx.stroke(),ctx.closePath(),ctx.fillStyle=colorKeyDownFill,ctx.fill(),ctx.closePath(),ctx.id=e,ctx.font=typeFont,ctx.fillStyle=colorKeyFontDown;t=t.toUpperCase();ctx.textAlign="center",ctx.fillText(t,o+c/2,n+s/2+4)}(o.name,o.code,o.x,o.y,o.w,o.h)}}function E(e){for(let t=0;t<e.length;t++){var o=e[t];!function(t,e,o,n,c,s){ctx.beginPath(),ctx.rect(o,n,c,s),ctx.strokeStyle=colorKeyUpStroke,ctx.lineWidth=strokeThickness,ctx.stroke(),ctx.closePath(),ctx.fillStyle=colorKeyUpFill,ctx.fill(),ctx.closePath(),ctx.id=e,ctx.font=typeFont,ctx.fillStyle=colorKeyFontUp;t=t.toUpperCase();ctx.textAlign="center",ctx.fillText(t,o+c/2,n+s/2+4)}(o.name,o.code,o.x,o.y,o.w,o.h)}}function R(t){for(key of t)key.s=0}function b(){scoreText.innerText="Score: "+score}function K(){livesText.innerText="Lives: "+lives}function T(){ctx.clearRect(0,0,canvas.width,canvas.height),ctx.lineWidth=strokeThickness,ctx.strokeStyle=colorKeyUpStroke,ctx.strokeRect(0,0,canvas.width,canvas.height),E(KEY_ARRAY),A(KEY_ARRAY),b(),K(),f(KEY_ARRAY),ctx.beginPath(),ctx.arc(x,y,ballRadius,0,2*Math.PI),ctx.fillStyle=colorBallFill,ctx.fill(),ctx.closePath(),ctx.strokeStyle=colorBallStroke,ctx.stroke(),ctx.closePath(),lives<1&&S(),(x+dx>canvas.width-ballRadius||x+dx<ballRadius)&&S(),(y+dy>canvas.height-ballRadius||y+dy<ballRadius)&&S(),x+=dx,y+=dy}function S(){lives--,m(82.407,context.currentTime,.116,"square"),m(77.782,context.currentTime+.116,.116,"square"),m(69.296,context.currentTime+.232,.232,"square"),(lives?function(){switch(scoreNote1=493.883,scoreNote2=659.255,x=canvas.width/2,y=canvas.height/2,ranNumX=Math.ceil(+Math.random())*(Math.round(Math.random())?1:-1),ranNumY=Math.ceil(+Math.random())*(Math.round(Math.random())?1:-1),ranNumX){case 1:directionH="east";break;case-1:directionH="west";break;default:return}switch(ranNumY){case 1:directionV="south";break;case-1:directionV="north";break;default:return}dx=speed*ranNumX,dy=speed*ranNumY}:w)()}fetch(GAMES_URL).then(t=>t.json()).then(t=>{!function(t){let o=t.filter(t=>null!==t.player.name),e=document.createElement("h1");e.style="font-size:3vw; text-center",e.innerText="Top Scores",o.sort((t,e)=>t.score<e.score?1:-1);let n=document.createElement("ol");for(let e=0;e<function(t,e){return t.length<e?t.length:e}(o,10);e++){let t=document.createElement("li");t.style="font-size:1.5vw;";var c,s=o[e];0<o.length&&(c=s.score,s=s.player.name,t.innerText=`${c} points......${s}`),n.append(t)}const i=document.createElement("button");i.setAttribute("id","btn-play"),i.setAttribute("class","btn btn-dark btn-lg"),i.setAttribute("type","button"),i.innerHTML="Play",i.addEventListener("click",()=>function(){fetch(PLAYERS_URL,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(t=>t.json()).then(t=>h(t)).catch(t=>console.log(`createPlayer: ${t}`))}());const a=document.createElement("div");a.setAttribute("id","centerWrapper"),a.append(i),leaderboard.append(e),leaderboard.append(n),leaderboard.append(a)}(t)}),KEY_ARRAY=[],hotkeys("command+`,command+1,command+2,command+3,command+4,command+5,command+6,command+7,command+8,command+9,command+0,command+-,command+=,command+delete,command+tab,command+q,command+w,command+e,command+r,command+t,command+y,command+u,command+i,command+o,command+p,command+[,command+],command+\\,command+capslock,command+a,command+s,command+d,command+f,command+g,command+h,command+j,command+k,command+l,command+;,command+',command+enter,command+shift,command+z,command+x,command+c,command+v,command+b,command+n,command+m,command+,,command+.,command+/,command+crtl,command+option,command+left,command+right,command+up,command+down,ctrl+`,ctrl+1,ctrl+2,ctrl+3,ctrl+4,ctrl+5,ctrl+6,ctrl+7,ctrl+8,ctrl+9,ctrl+0,ctrl+-,ctrl+=,ctrl+delete,ctrl+tab,ctrl+q,ctrl+w,ctrl+e,ctrl+r,ctrl+t,ctrl+y,ctrl+u,ctrl+i,ctrl+o,ctrl+p,ctrl+[,ctrl+],ctrl+\\,ctrl+capslock,ctrl+a,ctrl+s,ctrl+d,ctrl+f,ctrl+g,ctrl+h,ctrl+j,ctrl+k,ctrl+l,ctrl+;,ctrl+',ctrl+enter,ctrl+shift,ctrl+z,ctrl+x,ctrl+c,ctrl+v,ctrl+b,ctrl+n,ctrl+m,ctrl+,,ctrl+.,ctrl+/,ctrl+crtl,ctrl+option,ctrl+left,ctrl+right,ctrl+up,ctrl+down,option+`,option+1,option+2,option+3,option+4,option+5,option+6,option+7,option+8,option+9,option+0,option+-,option+=,option+delete,option+tab,option+q,option+w,option+e,option+r,option+t,option+y,option+u,option+i,option+o,option+p,option+[,option+],option+\\,option+capslock,option+a,option+s,option+d,option+f,option+g,option+h,option+j,option+k,option+l,option+;,option+',option+enter,option+shift,option+z,option+x,option+c,option+v,option+b,option+n,option+m,option+,,option+.,option+/,option+crtl,option+option,option+left,option+right,option+up,option+down",function(){R(KEY_ARRAY)}),m(174.614,context.currentTime,.116,"square"),m(195.998,context.currentTime+.116,.116,"square"),m(220,context.currentTime+.232,.232,"square"),ctx.width=window.innerWidth,ctx.height=window.innerHeight,v(row0),v(row1),v(row2),v(row3),v(row4),E(KEY_ARRAY),b(),K()});