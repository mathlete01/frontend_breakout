const colorLight="#dfdfdf",colorDark="#808080",colorWhite="#ffffff",colorBlack="#000000",canvas=document.getElementById("myCanvas");var colorKeyUpStroke,colorKeyUpFill,colorKeyFontUp,speed,lives,scoreNote1,scoreNote2,ctx,ballRadius,dx,dy,interval,score,directionV,directionH,gameOn,testing=!1,isMobile=!1;let BASE_URL="https://evening-hollows-06706.herokuapp.com";function resetGlobalVars(){var e=window.location.hostname;(testing=-1<e.indexOf("localhost"))||"http:"!=window.location.protocol||(window.location.href="https://"+e),lives=!0===testing?(console.log("* * * TESTING = TRUE * * * "),speed=1):(speed=.3,3),colorKeyUpStroke=colorLight,colorKeyUpFill=colorWhite,colorKeyFontUp=colorLight,scoreNote1=493.883,scoreNote2=659.255,ctx=canvas.getContext("2d"),ballRadius=10,dy=-1*(dx=speed),interval="",score=0,directionV="north",gameOn=!(directionH="east"),BASE_URL=process.env.BASE_URL}(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(isMobile=!0),resetGlobalVars(),isMobile&&(document.getElementById("mobile-user").style.display="block");const PLAYERS_URL=BASE_URL+"/players",GAMES_URL=BASE_URL+"/games",leaderboard=document.getElementById("leaderboard"),colorKeyDownStroke=colorBlack,colorKeyDownFill=colorBlack,colorKeyFontDown=colorWhite,colorKeyGrayFill=colorDark,colorBallFill=colorBlack,colorBallStroke=colorBlack,strokeThickness=1,livesText=document.getElementById("livesText"),scoreText=document.getElementById("scoreText"),scoreIncrement=1e3,keySegments=15,factor=5/keySegments,AudioContext=window.AudioContext||window.webkitAudioContext,context=new AudioContext,vol=.05,row0=[{name:"`",code:"Backquote",row:0,segments:1,status:0,position:0},{name:"1",code:"Digit1",row:0,segments:1,status:0,position:1},{name:"2",code:"Digit2",row:0,segments:1,status:0,position:2},{name:"3",code:"Digit3",row:0,segments:1,status:0,position:3},{name:"4",code:"Digit4",row:0,segments:1,status:0,position:4},{name:"5",code:"Digit5",row:0,segments:1,status:0,position:5},{name:"6",code:"Digit6",row:0,segments:1,status:0,position:6},{name:"7",code:"Digit7",row:0,segments:1,status:0,position:7},{name:"8",code:"Digit8",row:0,segments:1,status:0,position:8},{name:"9",code:"Digit9",row:0,segments:1,status:0,position:9},{name:"0",code:"Digit0",row:0,segments:1,status:0,position:10},{name:"-",code:"Minus",row:0,segments:1,status:0,position:11},{name:"=",code:"Equal",row:0,segments:1,status:0,position:12},{name:"Backspace",code:"Backspace",row:0,segments:2,status:0,position:13}],row1=[{name:"Tab",code:"Tab",row:1,segments:2,status:0,position:0},{name:"q",code:"KeyQ",row:1,segments:1,status:0,position:2},{name:"w",code:"KeyW",row:1,segments:1,status:0,position:3},{name:"e",code:"KeyE",row:1,segments:1,status:0,position:4},{name:"r",code:"KeyR",row:1,segments:1,status:0,position:5},{name:"t",code:"KeyT",row:1,segments:1,status:0,position:6},{name:"y",code:"KeyY",row:1,segments:1,status:0,position:7},{name:"u",code:"KeyU",row:1,segments:1,status:0,position:8},{name:"i",code:"KeyI",row:1,segments:1,status:0,position:9},{name:"o",code:"KeyO",row:1,segments:1,status:0,position:10},{name:"p",code:"KeyP",row:1,segments:1,status:0,position:11},{name:"[",code:"BracketLeft",row:1,segments:1,status:0,position:12},{name:"]",code:"BracketRight",row:1,segments:1,status:0,position:13},{name:"\\",code:"Backslash",row:1,segments:1,status:0,position:14}],row2=[{name:"CapsLock",code:"CapsLock",row:2,segments:2,status:0,position:0},{name:"a",code:"KeyA",row:2,segments:1,status:0,position:2},{name:"s",code:"KeyS",row:2,segments:1,status:0,position:3},{name:"d",code:"KeyD",row:2,segments:1,status:0,position:4},{name:"f",code:"KeyF",row:2,segments:1,status:0,position:5},{name:"g",code:"KeyG",row:2,segments:1,status:0,position:6},{name:"h",code:"KeyH",row:2,segments:1,status:0,position:7},{name:"j",code:"KeyJ",row:2,segments:1,status:0,position:8},{name:"k",code:"KeyK",row:2,segments:1,status:0,position:9},{name:"l",code:"KeyL",row:2,segments:1,status:0,position:10},{name:":",code:"Semicolon",row:2,segments:1,status:0,position:11},{name:"'",code:"Quote",row:2,segments:1,status:0,position:12},{name:"Enter",code:"Enter",row:2,segments:2,status:0,position:13}],row3=[{name:"Shift",code:"ShiftLeft",row:3,segments:2.5,status:0,position:0},{name:"z",code:"KeyZ",row:3,segments:1,status:0,position:2.5},{name:"x",code:"KeyX",row:3,segments:1,status:0,position:3.5},{name:"c",code:"KeyC",row:3,segments:1,status:0,position:4.5},{name:"v",code:"KeyV",row:3,segments:1,status:0,position:5.5},{name:"b",code:"KeyB",row:3,segments:1,status:0,position:6.5},{name:"n",code:"KeyN",row:3,segments:1,status:0,position:7.5},{name:"m",code:"KeyM",row:3,segments:1,status:0,position:8.5},{name:",",code:"Comma",row:3,segments:1,status:0,position:9.5},{name:".",code:"Period",row:3,segments:1,status:0,position:10.5},{name:"/",code:"Slash",row:3,segments:1,status:0,position:11.5},{name:"Shift",code:"ShiftRight",row:3,segments:2.5,status:0,position:12.5}],row4=[{name:"Function",code:"",row:4,segments:1,status:0,position:0},{name:"Control",code:"ControlLeft",row:4,segments:1,status:0,position:1},{name:"Alt",code:"AltLeft",row:4,segments:1,status:0,position:2},{name:"⌘",code:"MetaLeft",row:4,segments:1.5,status:0,position:3},{name:"Space",code:"Space",row:4,segments:5,status:0,position:4.5},{name:"⌘",code:"MetaRight",row:4,segments:1.5,status:0,position:9.5},{name:"Alt",code:"AltRight",row:4,segments:1,status:0,position:11},{name:"←",code:"ArrowLeft",row:4,segments:1,status:0,position:12},{name:"↑",code:"ArrowUp",row:4,segments:1,status:0,position:13},{name:"↓",code:"ArrowDown",row:4,segments:1,status:0,position:13},{name:"→",code:"ArrowRight",row:4,segments:1,status:0,position:14}],preventDefaultKeys={Tab:!0,Enter:!0};document.addEventListener("DOMContentLoaded",e=>{var o="",n="";function r(e,t,o,n){var s=context.createOscillator(),i=context.createOscillator(),a=context.createGain();s.type=n,i.type=n,a.gain.value=vol,s.connect(a),i.connect(a),a.connect(context.destination),s.frequency.value=e+1,i.frequency.value=e-2,a.gain.setValueAtTime(vol,t+o-.05),a.gain.linearRampToValueAtTime(0,t+o),s.start(t),i.start(t),s.stop(t+o),i.stop(t+o)}function l(){switch(directionV){case"north":directionV="south";break;case"south":directionV="north"}}function d(){switch(directionH){case"east":directionH="west";break;case"west":directionH="east"}}function t(e,t){testing&&console.log("showModal()");const o=document.createElement("div");o.classList.add("modal--"),o.innerHTML=`
      <div class="modal--inner">
        <div class="modal--top">
          <div class="modal--title">${e}</div>
          <button type="button" class="modal--close">
            <span class="material-icons">close</span>
          </button>
        </div>
        <div class="modal--content">${t}</div>
        <div class="modal--bottom"></div>
      </div>
    `,o.querySelector(".modal--close").addEventListener("click",()=>{testing&&console.log("showModal modal--close"),document.body.removeChild(o)}),document.body.appendChild(o)}function s(){const o=document.createElement("div");o.classList.add("modal--"),o.innerHTML=`
      <div class="modal--inner">
        <div class="modal--top">
          <div class="modal--title">Save Your Score</div>
          <button type="button" class="modal--close">
            <span class="material-icons">close</span>
          </button>
        </div>
        <div class="modal--content">
          <p>Type your name below</p>
          <input type="name" id="nameField" required />
        </div>
        <div class="modal--bottom"></div>
      </div>
    `,o.querySelector(".modal--close").addEventListener("click",()=>{testing&&console.log("showSaveModal: close"),document.body.removeChild(o),R()});var e=document.createElement("button"),e=(e.setAttribute("type","button"),e.classList.add("modal--button"),e.textContent="Skip This",e.addEventListener("click",()=>{testing&&console.log("showSaveModal: skip"),document.body.removeChild(o),R()}),o.querySelector(".modal--bottom").appendChild(e),document.createElement("button"));e.setAttribute("type","button"),e.classList.add("modal--button"),e.textContent="Save",e.addEventListener("click",()=>{var e,t;testing&&console.log("showSaveModal: save"),e=nameField.value.toUpperCase(),testing&&console.log("savePlayer:name = "+e),t={id:CURRENT_PLAYER,name:e},t={method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)},fetch(PLAYERS_URL,t).then(e=>e.json()).then(function(e){testing&&console.log("updateGame(): git name = "+e);e={id:CURRENT_GAME,name:e},e={method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)};fetch(GAMES_URL,e).then(e=>e.json()).then(()=>E()).catch(e=>console.log("updateGame: "+e))}(e)).catch(e=>console.log("savePlayer: "+e)),document.body.removeChild(o)}),o.querySelector(".modal--bottom").appendChild(e),document.body.appendChild(o)}function i(){testing&&console.log("getLeaderboard()"),fetch(GAMES_URL).then(e=>e.json()).then(e=>{testing&&console.log("renderLeaderboard()"),r(174.614,context.currentTime,.116,"square"),r(195.998,context.currentTime+.116,.116,"square"),r(220,context.currentTime+.232,.232,"square");var t=e.filter(e=>null!==e.player.name),o=((e=document.createElement("h1")).className="title",e.innerText="Top Scores",t.sort((e,t)=>e.score<t.score?1:-1),document.createElement("ol"));for(let e=0;e<function(e,t){return e.length<t?e.length:t}(t,10);e++){var n,s=document.createElement("li"),i=(s.className="list-item",t[e]);0<t.length&&(n=i.score,i=i.player.name,s.innerText=n+" points......"+i),o.append(s)}var a=document.createElement("a"),c=(a.setAttribute("id","btn-play"),a.setAttribute("class","playBtn"),a.innerHTML="PLAY",a.addEventListener("click",()=>{testing&&console.log("createPlayer()"),fetch(PLAYERS_URL,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(e=>e.json()).then(e=>{testing&&console.log("setCurrentPlayer(): obj =",e),e=CURRENT_PLAYER=e.id;testing&&console.log("createGame()"),leaderboard.innerHTML="",e={player_id:e},e={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)},fetch(GAMES_URL,e).then(e=>e.json()).then(e=>{testing&&console.log("setCurrentGame(): obj =",e),CURRENT_GAME=e.id,testing&&console.log("startGame()"),gameOn=!0,S(),r(391.995,context.currentTime,.116,"square"),r(391.995,context.currentTime+.116,.116,"square"),r(523.251,context.currentTime+.232,.232,"square"),testing&&console.log("activateKeyListeners()"),document.body.addEventListener("keydown",e=>{{let t=e.code;return preventDefaultKeys[t]&&e.preventDefault(),(e=KEY_ARRAY.find(({code:e})=>e===t))&&(e.s=1),!1}}),document.body.addEventListener("keyup",o=>{{let t=o.code,e=KEY_ARRAY.find(({code:e})=>e===t);return e&&(e.s=0),!1}}),m(),interval=setInterval(v,10)}).catch(e=>console.log("createGame Failed: "+e))}).catch(e=>console.log("createPlayer: "+e))}),document.createElement("div"));c.setAttribute("class","centerWrapper"),c.append(a),leaderboard.append(e),leaderboard.append(o),leaderboard.append(c),b(),k()})}function m(){testing&&console.log("initAllKeys()"),KEY_ARRAY=[],a(row0),a(row1),a(row2),a(row3),a(row4)}function a(t){for(let e=0;e<t.length;e++){var o=t[e].name,n=t[e].code,s=Math.round(t[e].segments*keyWidth),i=keyHeight,a=t[e].position*keyWidth,c=t[e].row*keyHeight,r=t[e].status;KEY_ARRAY.push({name:o,code:n,x:a,y:c,w:s,h:i,s:r})}}function u(t){for(let e=0;e<t.length;e++){var o=t[e],n=(r=c=a=i=s=n=void 0,o.name),s=o.code,i=o.x,a=o.y,c=o.w,r=o.h;ctx.beginPath(),ctx.rect(i,a,c,r),ctx.strokeStyle=colorKeyUpStroke,ctx.lineWidth=strokeThickness,ctx.stroke(),ctx.closePath(),ctx.fillStyle=colorKeyUpFill,ctx.fill(),ctx.closePath(),ctx.id=s,ctx.font=typeFont,ctx.fillStyle=colorKeyFontUp,s=n.toUpperCase(),ctx.textAlign="center",ctx.fillText(s,i+c/2,a+r/2+4)}}function p(t){for(let e=0;e<t.length;e++){var o,n,s,i,a,c,r=t[e];1==r.s&&(c=a=i=s=n=o=void 0,o=r.name,n=r.code,s=r.x,i=r.y,a=r.w,c=r.h,ctx.beginPath(),ctx.rect(s,i,a,c),ctx.strokeStyle=colorKeyDownStroke,ctx.lineWidth=strokeThickness,ctx.stroke(),ctx.closePath(),ctx.fillStyle=colorKeyDownFill,ctx.fill(),ctx.closePath(),ctx.id=n,ctx.font=typeFont,ctx.fillStyle=colorKeyFontDown,n=o.toUpperCase(),ctx.textAlign="center",ctx.fillText(n,s+a/2,i+c/2+4))}}function c(){testing&&console.log("initializeCanvas()"),w=window.innerWidth,h=window.innerHeight,typeFont=window.innerWidth/100+"px Courier New",canvas.width=w,canvas.height=factor*w,x=canvas.width/2,y=canvas.height/2,keyWidth=w/keySegments,keyHeight=keyWidth,testing&&console.log("renderGameboard()"),m(),u(KEY_ARRAY),p(KEY_ARRAY),i()}function g(){w=window.innerWidth,h=window.innerHeight,typeFont=window.innerWidth/100+"px Courier New",canvas.width=w,canvas.height=factor*w,x=canvas.width/2,y=canvas.height/2,keyWidth=w/keySegments,keyHeight=keyWidth,m(),u(KEY_ARRAY),p(KEY_ARRAY)}function v(){ctx.clearRect(0,0,canvas.width,canvas.height),ctx.lineWidth=strokeThickness,ctx.strokeStyle=colorKeyUpStroke,ctx.strokeRect(0,0,canvas.width,canvas.height),u(KEY_ARRAY),p(KEY_ARRAY),b(),k();var t=KEY_ARRAY;for(let e=0;e<t.length;e++){var o=t[e],n=Math.round(o.x),s=Math.round(o.x+o.w),i=Math.round(o.y),a=Math.round(o.y+o.h),c=ballRadius;1==o.s&&(y>i+c&&y<a-c&&x>n+c&&x<s-c&&(o.s,function(e,t,o,n,s,i){ctx.beginPath(),ctx.rect(o,n,s,i),ctx.strokeStyle=colorKeyDownStroke,ctx.lineWidth=strokeThickness,ctx.stroke(),ctx.closePath(),ctx.fillStyle=colorKeyGrayFill,ctx.fill(),ctx.closePath(),ctx.id=t,ctx.font=typeFont,ctx.fillStyle=colorKeyFontDown;t=e.toUpperCase();ctx.textAlign="center",ctx.fillText(t,o+s/2,n+i/2+4)}(o.name,o.code,o.x,o.y,o.w,o.h)),y>i-c&&y<a+c&&(x>n-c&&x<n+c&&"east"===directionH&&(dx=-dx,d(),f()),x>s-c)&&x<s+c&&"west"===directionH&&(dx=-dx,d(),f()),x>n-c)&&x<s+c&&(y>i-c&&y<i+c&&"south"===directionV&&(dy=-dy,l(),f()),y>a-c)&&y<a+c&&"north"===directionV&&(dy=-dy,l(),f())}ctx.beginPath(),ctx.arc(x,y,ballRadius,0,2*Math.PI),ctx.fillStyle=colorBallFill,ctx.fill(),ctx.closePath(),ctx.strokeStyle=colorBallStroke,ctx.stroke(),ctx.closePath(),lives<1&&A(),(x+dx>canvas.width-ballRadius||x+dx<ballRadius)&&A(),(y+dy>canvas.height-ballRadius||y+dy<ballRadius)&&A(),x+=dx,y+=dy}function b(){scoreText.innerText="Score: "+score}function k(){livesText.innerText="Lives: "+lives}function f(){for(key of KEY_ARRAY)key.s=0;r(scoreNote1,context.currentTime,.116,"square"),r(scoreNote2,context.currentTime+.116,.232,"square"),score+=scoreIncrement,scoreNote1+=10,scoreNote2+=10,dx*=1.3}function A(){if(testing&&console.log("fail()"),lives--,r(82.407,context.currentTime,.116,"square"),r(77.782,context.currentTime+.116,.116,"square"),r(69.296,context.currentTime+.232,.232,"square"),lives){switch(testing&&console.log("initNextPlay()"),scoreNote1=493.883,scoreNote2=659.255,x=canvas.width/2,y=canvas.height/2,ranNumX=Math.ceil(+Math.random())*(Math.round(Math.random())?1:-1),ranNumY=Math.ceil(+Math.random())*(Math.round(Math.random())?1:-1),ranNumX){case 1:directionH="east";break;case-1:directionH="west";break;default:return}switch(ranNumY){case 1:directionV="south";break;case-1:directionV="north";break;default:return}dx=speed*ranNumX,dy=speed*ranNumY}else{testing&&console.log("endGame()"),gameOn=!1,S(),testing&&console.log("soundGameOver()"),r(207.652,context.currentTime,.116,"square"),r(174.614,context.currentTime+.116,.116,"square"),r(146.832,context.currentTime+.232,.232,"square"),clearInterval(interval),interval="",testing&&console.log("preSaveOrNot()");var e={id:CURRENT_GAME,score:score},e={method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)};fetch(GAMES_URL,e).then(e=>e.json()).then(function(){testing&&console.log("saveOrNot()");(0<score?s:R)()}()).catch(e=>console.log("endGame: "+e))}}function S(){!0===gameOn?(colorKeyUpStroke=colorBlack,colorKeyUpFill=colorWhite,colorKeyFontUp=colorBlack):!1===gameOn&&(colorKeyUpStroke=colorLight,colorKeyUpFill=colorWhite,colorKeyFontUp=colorLight)}function R(){testing&&console.log("skip()"),E()}function E(){testing&&console.log("reloadGame()"),resetGlobalVars(),c(),leaderboard.innerHTML=""}Promise.all([fetch("content/about.html").then(e=>e.text()),fetch("content/hireMe.html").then(e=>e.text())]).then(([e,t])=>{o=e,n=t}),document.getElementById("aboutNav").addEventListener("click",()=>{t("About!",o)}),document.getElementById("hireMeNav").addEventListener("click",()=>{t("Hire Me!",n)}),testing&&console.log("initializeWindowListener()"),window.addEventListener("resize",g,!1),c()});